<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>板材管理</title>
    <!-- layui css -->
    <link rel="stylesheet" href="../static/layui/css/layui.css" />
    <!-- jq js -->
    <script type="text/javascript" src="../static/js/jquery-3.1.1.min.js"></script>
    <!-- layui js -->
    <script type="text/javascript" src="../static/layui/layui.js"></script>
</head>
<body>
<div class="demoTable">
    搜索板材编号：
    <div class="layui-inline">
        <input class="layui-input" name="id" id="demoReload"
               autocomplete="off">
    </div>
    <button class="layui-btn" id="reload" data-type="reload">搜索</button>
</div>

<table class="layui-hide" id="tableBoard" lay-filter="user"></table>
<div id="page"></div>
<script id="board" type="text/html">
    <form class="layui-form" id="boardFrom">
        <div class="layui-form-item">
            <label class="layui-form-label">板材名称：</label>
            <div class="layui-input-inline">
                <input type="hidden" name="id" id="id" />
                <input type="text" name="name" id="name" required lay-verify="required" placeholder="请输入板材名称" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">板材编号：</label>
            <div class="layui-input-inline">
                <input type="text" name="code" id="code" required lay-verify="required" placeholder="请输入板材编号" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">板材数量：</label>
            <div class="layui-input-inline">
                <input type="text" name="num" id="num" required lay-verify="required" placeholder="请输入板材数量" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">板材价格：</label>
            <div class="layui-input-inline">
                <input type="text" name="price" id="price" required lay-verify="required" placeholder="请输入板材价格" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">计价方式：</label>
            <div class="layui-input-inline">
                <select name="units" id="units" lay-verify="">
                    <option value="平方">平方</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">供货商：</label>
            <div class="layui-input-inline">
                <input type="text" name="supplier" id="supplier" required lay-verify="required" placeholder="请输入供货商" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">单位：</label>
            <div class="layui-input-inline">
                <input type="text" name="company" id="company" required lay-verify="required" placeholder="请输入单位" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">规格：</label>
            <div class="layui-input-inline">
                <input type="text" name="spec" id="spec" required lay-verify="required" placeholder="请输入规格" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
    </form>
</script>
</body>
<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="insertBoard">新增板材</button>
    </div>
</script>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
<script type="text/html" id="priceTpl">
    <i class="layui-icon layui-icon-rmb">：{{ d.price }}</i>
</script>
<script>
    layui.use(['form','table','laypage'], function() {
        var form = layui.form, table = layui.table, $ = layui.jquery, laypage = layui.laypage;


        pageList("", 1);

        $("#reload").click(function(){
            var param = $("#demoReload").val();
            pageList(param,1);
        })

        function pageList(param,limit){
            //方法级渲染
            table.render({
                elem : '#tableBoard',
                url : '../board/selectBoardList',
                where:{
                    limit:limit,
                    code:param
                },
                toolbar: '#toolbarDemo',
                cellMinWidth: 80,
                cols : [ [ {
                    field : 'id',
                    title : 'ID',
                    sort : true,
                    fixed : true
                }, {
                    field : 'name',
                    title : '板材名称',
                }, {
                    field : 'code',
                    title : '板材编号',
                }, {
                    field : 'num',
                    title : '板材数量',
                }, {
                    field : 'price',
                    title : '基材价格',
                    templet: '#priceTpl'
                }, {
                    field : 'units',
                    title : '计价方式',
                }, {
                    field : 'supplier',
                    title : '供货商',
                }, {
                    field : 'company',
                    title : '单位',
                }, {
                    field : 'spec',
                    title : '规格',
                },{
                    field : 'right',
                    title : '操作',
                    toolbar: '#barDemo',
                    width : 150
                }
                ] ],
                id : 'testReload',
                page : false,
                done : function(res, curr, count){
                    laypage.render({
                        elem : 'page',
                        count : count,
                        limit : res.pageSize,
                        curr : res.pageNum,
                        layout : [ 'count', 'prev', 'page', 'next', 'skip' ],
                        jump : function(obj, first) {
                            if (!first) {
                                pageList(param,obj.curr);
                            }
                        }
                    });
                }
            });
        }
        //头工具栏事件
        table.on('toolbar(user)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id);
            switch(obj.event){
                case 'insertBoard':
                    layer.open({
                        type : 0,
                        title : '新增板材',
                        content : $("#board").html(),
                        area : [ '400px', '520px' ],
                        offset : 'auto',
                        btn : [ '新增', '取消' ],
                        btnAlign : 'c',
                        closeBtn : 0,
                        anim : 6,
                        success : function(layero, index) {
                        },
                        yes : function(index, layero) {
                            //
                            $.ajax({
                                url : "../board/saveBoard",
                                type : "post",
                                data : $("#boardFrom").serialize(),
                                success : function(result) {
                                    if (result.msg == "录入成功") {
                                        layer.msg(result.msg,{icon : 6,time : 1000},function() {
                                            layer.close(index);
                                            window.location.reload();
                                        });
                                    } else {
                                        layer.msg(result.msg,{icon : 5,time : 2000},function() {
                                            layer.close(index);
                                            window.location.reload();
                                        });
                                    }
                                }
                            });
                        }
                    });
                    form.render();
                    break;
            };
        });
        //监听行工具事件
        table.on('tool(user)', function(obj) {
            var data = obj.data;
            //console.log(obj)
            if (obj.event === 'del') {
                layer.confirm('你确定要删除 【 '+data.code+' 】吗？', {
                    icon : 5,
                    title : '删除板材',
                    offset : 'I'
                }, function(index) {
                    //do something
                    $.ajax({
                        url : "../board/deleteBoard",
                        type : "post",
                        data : {
                            id:data.id
                        },
                        success : function(result) {
                            if(result.msg=="删除成功"){
                                layer.msg(result.msg,{icon: 6,time:2000},function(){
                                    layer.close(index);
                                    window.location.reload();
                                });
                            }else{
                                layer.msg(result.msg,{icon: 5,time:2000});
                            }
                        }
                    });
                    layer.close(index);
                });
                form.render();
            } else if (obj.event === 'edit') {
                layer.open({
                    type : 0,
                    title : '编辑板材',
                    content : $("#board").html(),
                    area : [ '400px', '520px' ],
                    offset : 'auto',
                    btn : [ '更新', '取消' ],
                    btnAlign : 'c',
                    closeBtn : 0,
                    anim : 6,
                    success : function(layero, index) {
                        //
                        $("#boardFrom").reset();
                        $("#id").val(data.id);
                        $("#code").val(data.code);
                        $("#price").val(data.price);
                        $("#units").val(data.units);
                        $("#supplier").val(data.supplier);
                        $("#company").val(data.company);
                        $("#name").val(data.name);
                        $("#spec").val(data.spec);
                        $("#num").val(data.num);
                    },
                    yes : function(index, layero) {
                        //
                        $.ajax({
                            url : "../board/updateBoard",
                            type : "post",
                            data : $("#boardFrom").serialize(),
                            success : function(result) {
                                if(result.msg=="更新成功"){
                                    layer.msg(result.msg,{icon: 6,time:2000},function(){
                                        layer.close(index);
                                        window.location.reload();
                                    });
                                }else{
                                    layer.msg(result.msg,{icon: 5,time:2000});
                                }
                            }
                        });
                    }
                });
                form.render();
            }
        });
        /* $('.demoTable .layui-btn').on('click', function() {
         var type = $(this).data('type');
         active[type] ? active[type].call(this) : '';
         }); */
    });
</script>
</html>